{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/introduction.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
{% endblock %}

{% block content %}
<div class="container">
  <!-- Top row with title and home icon -->
  <div class="intro-header-row">
    <div class="home-icon-container">
      <!-- Empty space to balance layout -->
    </div>
    <h1 class="pixel-font intro-title">Caf√©Craft</h1>
    <div class="home-icon-container">
      <a href="{{ url_for('home') }}">
        <img src="{{ url_for('static', filename='images/home.png') }}" alt="Home" class="home-icon">
      </a>
    </div>
  </div>

  <!-- Three column layout for main content -->
  <div class="intro-content">
    <!-- User Column (Left) -->
    <div class="character-column">
      <img src="{{ url_for('static', filename='images/user_happy.png') }}" alt="User" class="character-portrait">
      <div class="pixel-font character-name">{{ name }}</div>
      
      <!-- Coffee Level -->
      <div class="coffee-level">
        {% for i in range(6) %}
          {% if i < caffeine_level %}
            <img src="{{ url_for('static', filename='images/coffee_beans.png') }}" alt="Filled Bean" class="coffee-bean">
          {% else %}
            <img src="{{ url_for('static', filename='images/coffee_beans.png') }}" alt="Empty Bean" class="coffee-bean bean-empty">
          {% endif %}
        {% endfor %}
      </div>
      
      <!-- User Speech Bubble -->
      <div class="speech-bubble">
        <p class="pixel-font typewriter-text">I did it! My first {{ recipe.name }}!</p>
      </div>
    </div>
    
    <!-- Feedback Column (Middle) -->
    <div class="crafting-column">
      <div class="pixel-font crafting-title">{{ recipe.name }}</div>
      <div class="result-card">
        <img src="{{ url_for('static', filename='images/' + recipe_id + '.png') }}" alt="{{ recipe.name }}" class="recipe-result-img">
        <div class="recipe-description">
          <p class="pixel-font">{{ recipe.description }}</p>
          <p class="pixel-font">{{ recipe.additional_info }}</p>
        </div>
      </div>
      
      <div class="navigation-buttons">
        <div class="back-button-container">
          <a href="{{ url_for('recipes') }}" class="continue-button">Back to Recipes</a>
        </div>
        
        <div class="next-button-container">
          {% if recipe_id == "mocha" %}
          <a href="{{ url_for('quiz', qid=1) }}" class="continue-button">Take the Quiz!</a>
          {% else %}
          {% set recipe_sequence = ["espresso", "americano", "macchiato", "latte", "mocha"] %}
          {% set ns = namespace(next_recipe=None) %}
          {% for i in range(recipe_sequence|length) %}
            {% if recipe_sequence[i] == recipe_id %}
              {% if i+1 < recipe_sequence|length %}
                {% set ns.next_recipe=recipe_sequence[i+1] %}
              {% endif %}
            {% endif %}
          {% endfor %}
          {% if ns.next_recipe %}
            <a href="{{ url_for('learn', recipe_id=ns.next_recipe) }}" class="continue-button">Next Recipe</a>
          {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Dr. Coffee Column (Right) -->
    <div class="character-column">
      <img src="{{ url_for('static', filename='images/dr_coffee.png') }}" alt="Dr. Coffee" class="character-portrait">
      <div class="pixel-font character-name">Dr. Coffee</div>
      
      <!-- Coffee Level (for symmetry) -->
      <div class="coffee-level">
      </div>
      
      <!-- Speech Bubble -->
      <div class="speech-bubble">
        <p class="pixel-font typewriter-text">Well done! You've successfully crafted your first {{ recipe.name }}!</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}