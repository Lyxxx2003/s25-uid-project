{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/introduction.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
{% endblock %}

{% block content %}
<div class="container">
  <!-- Top row with title and home icon -->
  <div class="intro-header-row">
    <div class="home-icon-container">
      <a href="{{ url_for('home') }}">
        <img src="{{ url_for('static', filename='images/home.png') }}" alt="Home" title="Restart" class="home-icon">
      </a>
    </div>
    <h1 class="main-title intro-title">Caf√©Craft</h1>
    <div class="home-icon-container">
    </div>
  </div>

  <!-- Three column layout for main content -->
  <div class="intro-content">
    <!-- User Column (Left) -->
    <div class="character-column">
      <img src="{{ url_for('static', filename='images/user_tired.png') }}" alt="User" class="character-portrait">
      <div class="pixel-font character-name">{{ name }}</div>
      
      <!-- Coffee Level -->
      <div class="coffee-level mb-2">
        {% for i in range(6) %}
          {% if i < caffeine_level %}
            <img src="{{ url_for('static', filename='images/coffee_beans.png') }}" alt="Filled Bean" title="Filled Bean" class="coffee-bean">
          {% else %}
            <img src="{{ url_for('static', filename='images/coffee_beans.png') }}" alt="Empty Bean" title="Empty Bean" class="coffee-bean bean-empty">
          {% endif %}
        {% endfor %}
      </div>
      
      <!-- Backpack -->
      <div class="backpack">
        <div class="pixel-font backpack-title text-center">BACKPACK</div>
        <div class="backpack-grid">
          {% for i in range(8) %}
            <div class="backpack-slot"></div>
          {% endfor %}
        </div>
      </div>
    </div>
    
    <!-- Recipes Column (Middle) -->
    <div class="crafting-column">
      <div class="pixel-font crafting-title">RECIPES</div>
      <div class="recipe-list">
        {% set recipe_sequence = ["espresso", "americano", "macchiato", "latte", "mocha"] %}
        {% for recipe_id in recipe_sequence %}
        <div class="recipe-item {% if recipe_id in unlocked_recipes %}unlocked{% else %}locked{% endif %}">
            {% if recipe_id in unlocked_recipes %}
            <div class="recipe-content">
                <a href="{{ url_for('learn', recipe_id=recipe_id) }}" class="recipe-details">
                    <div class="recipe-row">
                        <span class="recipe-name">{{ game_data['recipes'][recipe_id].name }}</span>
                        <div class="recipe-ingredients">
                            {% for ingredient in game_data['recipes'][recipe_id].ingredients %}
                            <img src="{{ url_for('static', filename='images/' + ingredient + '.png') }}"
                                alt="{{ game_data['items'][ingredient].name }}" title="{{ game_data['items'][ingredient].name }}" class="ingredient-icon">
                            {% if not loop.last %}
                            <span class="plus">+</span>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </a>
            </div>
            {% else %}
            <div class="recipe-content locked">
                <div class="recipe-row justify-content-center">
                    <div class="recipe-ingredients">
                        <img src="{{ url_for('static', filename='images/locked.png') }}" alt="Locked" class="locked-icon">
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
      </div>
      <!-- Quiz Button -->
      {% if all_unlocked %}
      <div class="quiz-button-container">
        <!-- <a href="{{ url_for('quiz_redirect') }}" class="continue-button">Take Quiz!</a> -->
        {% if session.get('quiz_progress') %}
          <div class="quiz-button-row">
            <a href="{{ url_for('quiz_redirect') }}" class="continue-button small-quiz-button">Continue Quiz</a>
            <form action="{{ url_for('reset_quiz') }}" method="post">
              <button type="submit" class="continue-button small-quiz-button light-button">Start New Quiz</button>
            </form>
          </div>
        {% else %}
          <a href="{{ url_for('quiz', qid=1) }}" class="continue-button">Take Quiz!</a>
        {% endif %}
      </div>
      {% endif %}
    </div>
    
    <!-- Dr. Coffee Column (Right) -->
    <div class="character-column">
      <img src="{{ url_for('static', filename='images/dr_coffee.png') }}" alt="Dr. Coffee" class="character-portrait">
      <div class="pixel-font character-name">Dr. Coffee</div>
      
      <!-- Coffee Level (for symmetry) -->
      <div class="coffee-level">
      </div>
      
      <!-- Speech Bubble -->
      <div class="speech-bubble">
        {% if unlocked_recipes|length == 1 %}
        <p class="pixel-font typewriter-text">These are the coffee recipes you can learn! For now, you only know how to make
            espresso. Click on it to learn more!</p>
        {% else %}
        <p class="pixel-font typewriter-text">Great job! You've unlocked more recipes. Keep learning and crafting to
            discover all the coffee drinks!</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- <script>
  // Handle taking the quiz button click
  const hasInProgress = {{ 'true' if session.get('last_qid') and session.get('last_qid') != 1 else 'false' }};
  const lastQid = {{ session.get('last_qid', 1) }};
</script> -->
<style>
  /* .quiz-button-row .small-quiz-button {
    margin-top: 6px;
  } */
  /* .quiz-button-row {
    display: flex;
    gap: 12px; 
    justify-content: center; 
    flex-wrap: wrap; 
    margin-top: 10px;
  } */

  .quiz-button-row .small-quiz-button {
    margin-top: 0; /* remove extra top spacing */
  }
</style>
{% endblock %}